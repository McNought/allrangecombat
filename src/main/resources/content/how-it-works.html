title=How It Works
date=2016-02-254
type=page
status=published
~~~~~~
    <div class="section">
      <div class="container">
        <div class="row">
          <div class="col-lg-10">
            <h1>How It works</h1>
            <h2>Overview</h2>
          </div>
        </div>
      </div>
    </div>
    <div class="section">
      <div class="container">
        <div class="row">
          <div class="col-lg-10">
            <p>The essential premise of OBSIDIAN is to provide a Powershell script to
              a windows server which will download the appropriate binaries and run any
              installers if required.
              <br>To facilitate this there needs to be a website and that website needs
              to be easy to maintain when new development environments are available.
              <br>
            </p>
          </div>
        </div>
      </div>
    </div>
    <div class="section">
      <div class="container">
        <div class="row">
          <div class="col-lg-10">
            <h2 contenteditable="true">The project</h2>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-10">
            <p>There is an Eclipse project located at&nbsp;
              <a href="http://ariel/tfs/I9700013/Incubator/_git/Downloadable%20Development%20Environment">http://ariel/tfs/I9700013/Incubator/_git/Downloadable%20Development%20Environment</a>&nbsp;which contains all the code for the project.
              <br>The binaries are
              <b>NOT</b>&nbsp;stored in that repository.
              <br>The project can be imported into Eclipse using the standard technique
              of clone &amp; import.
              <br>Once instaled the project has the standard maven structure, with the files
              needed by
              <a href="http://jbake.org/docs/2.4.0/#create_a_project">JBAKE</a>:
              <br>
            </p>
            <div class="col-lg-5">
              <img src="assets\images\how-it-works\projectLayout.PNG" class="img-responsive">
            </div>
            <div class="col-lg-5">
              <ol>
                <li>
                  <b>Assets</b>The folder contains all the resources that are copied unchanged
                  directly into the built project.
                  <br>In this project there are html files and actuall assets located in an
                  <i>assets&nbsp;</i>subfolder;&nbsp;The assets directory is where you should
                  place your static files such as images, CSS files and JavaScript files
                  etc. These files are copied over to the baked output as is. You can create
                  any directory structure you like in the assets directory and this structure
                  will be maintained when copied.</li>
                <li>&nbsp;The assets directory is where you should place your static files
                  such as images, CSS files and JavaScript files etc. These files are copied
                  over to the baked output as is. You can create any directory structure
                  you like in the assets directory and this structure will be maintained
                  when copied</li>
                <li>
                  <b>Content</b>This is the folder that is processed by JBAKE to produce content;
                  <br>There is a file in this folder per environment to define &nbsp;the information
                  for each environment. The content directory is where your content files
                  should be placed, these files will be "mixed" with the templates to generate
                  the baked output. Again you can create any directory structure you like
                  for your content, this structure will be maintained when the baked output
                  is created.</li>
                <li>
                  <b>Templates</b>These are
                  <a href="http://www.thymeleaf.org/">Thymeleaf</a>&nbsp;templates for creating the presentation site for the project website&nbsp;</li>
              </ol>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-10">
            <h2>What is in an Environment</h2>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-10">
            <p>An environment is: a page on the website, a set of installable components
              and powershell fragment to install it.</p>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-10">
            <h2>Creating a new Environment</h2>
            <p>The steps to create a new environment are straight forwards:
              <br>
            </p>
            <ol>
              <li>
                <b>Determine what the Developer needs to have installed.
                  <br>
                </b>This should be the easy part, simply make a note of all the tools that
                they are currently using;</li>
              <li>
                <b>Place the instalation binaries on to the
                  <i>/dependencies&nbsp;</i>folder on the web server;
                  <br>
                </b>The files placed onto the server MUST be a ZIP file.
                <br>They must also be named to include a version number;</li>
              <li>
                <b>Create a name for the environment
                  <br>
                </b>This sounds trivial but the name is used for all the subsequent files
                and the environment name;</li>
              <li>
                <b>Create the powershell script fragment;
                  <br>
                </b>The actual functions needed are described in the next section but the
                file needs to be created in the&nbsp;
                <i>/src/main/resources/assets/assets/powershell&nbsp;</i>folder.
                <br>Once created the project pom.xml needs to have a reference to it.
                <br>This needs to be added to the antrun section of the build process:
                <br>
                <img src="assets\images\how-it-works\mvnAntRun.PNG" class="img-responsive">Create a new section
                <i>&lt;concat&gt;...&lt;/concat&gt;</i>and add the new powershell fragment
                as the second file.
                <br>
              </li>
              <li>
                <b>Create the site reference page;</b>This file goes in the&nbsp;
                <i>/src/main/resources/content</i>folder.
                <br>This file follows the style set by <a href="http://jbake.org/docs/2.4.0/#metadata_header">JBAKE </a>and is a set of META data followed
                by a HTML fragment.
                <br><img src="assets\images\how-it-works\envDescription.PNG" class="img-responsive">
                <br>The META data for the environment differs slightly from the standard described on the&nbsp;JBAKE documentation page.<br>The <b>tags</b>&nbsp;should be a list of that the environment contains. There is no real reason for this it is just nice.<br>The <b>date</b>&nbsp;should be used to create a new version or to note that a set up has altered;<br>The <b>install-uri</b>&nbsp;must be set to the path of the script fragment. (This is to be be reviewed)<br>It is possible to add further META data (ie install-foo) in these cases please prefix with <i>install-</i>. &nbsp;</li>
              <li><b>Build the website<br></b>This is achieved by running <i>mvn package</i>&nbsp;which will cause a ZIP file of the website to be created.<br>This file can be then passed to the web server.<br>It is also possible to build the site with out creating the ZIP using the command mvn package which will place the site into the <i>/target/site-res</i>&nbsp;folder.&nbsp;</li>
            </ol>
            
          </div>
        </div>
        <div class="row">
          <div class="col-lg-10">
            <h2>The website</h2>
            <p>The website you are viewing is constructed from its raw assets using a
              MAVEN build script.&nbsp;
              <br>The script&nbsp;constructs both the pages and the
              <a href="https://msdn.microsoft.com/en-us/powershell/mt173057.aspx">Powershell</a>&nbsp;scripts all from a series of templates using
              <a href="http://jbake.org/">JBAKE</a>&nbsp;and
              <a href="https://ant.apache.org/manual/Tasks/concat.html">Concat with Ant-run</a>.&nbsp;<br><br><b class="text-warning">TBC - The binaries are not stored not stored in the project. It has yet to be determined where they should be stored.</b>
            </p>
            <h3>Powershell Scripts</h3>
            <p>The Powershell scripts are located in the project folder&nbsp;
              <i>/src/main/resources/assets/assets/powershell</i>.
              <br>There are three parts to a script
              <i>install-start.ps1</i>,
              <i>install-end.ps1</i>and an instalation specific script.
              <br>The start &amp; end are standardised across all environments and it is
              advised that they are maintained in your Eclipse IDE using the
              <a href="http://dalexandrov.github.io/PowershellEditor/">Powershell Plugin</a>.
              <br>The install specific script needs to have four functions defined in it.
              These functiona are invoked by the start and end scripts:
              <br>
            </p>
          </div>
        </div>
        <div class="row">
          <div class="col-lg-10">
            <h4>setupComponentVersions()</h4>
            <p contenteditable="true">This function simply defines a set of
              <b>Global</b>&nbsp;environment variables to be used throughout the script.
              <br>Each variable is related to a specific component in the environment.
              <br>It is advised that the variables are:
              <br>
            </p>
            <ol>
              <li>
                <b>version
                  <i>ComponentName</i>
                </b>Which is just the version number of the component. This is usefull later
                should the version number change.</li>
              <li>
                <b>zip
                  <i>ComponentName</i>
                </b>Which is the name of the zipped binary component as stored in the project.
                See the section on
                <a href="#components">components</a>.&nbsp;</li>
            </ol>
            <img src="assets\images\how-it-works\setupComponentShortcuts.PNG" class="img-responsive">
            <h4>setupDownloadableComponents()</h4>
            <p>The downloadable components are just waht they say on the tin; the files
              to download.
              <br>
            </p>
            <img src="assets\images\how-it-works\setupDownloadableComponents.PNG" class="img-responsive">
            <p>Each line describes one installation.
              <br>the function downloadComponent() has
              <b>six</b>&nbsp;parameters:</p>
            <ol>
              <li>
                <b>componentName&nbsp;</b>
                <span style="line-height: 1.42857;">The name and the folder to install the component into;</span>
                <br>
              </li>
              <li>
                <b>subfolderName</b>The folder the binaries are extracted into. If the folder
                extracted into defaults to componentName-version then this can be an empty
                string;</li>
              <li>
                <b>versionComponent</b>the version number;</li>
              <li>
                <b>zipComponentName</b>the name of the zip file to download, without the
                ZIP extension;</li>
              <li>
                <b>componentSubPath</b>the path where the executables are loaced with in
                the subfolderName directory; &nbsp;
                <br>
                <i>Optional - defaults to "";</i>
              </li>
              <li>
                <b>componentPathName</b>an alias name for the component when batch scripts
                &amp; paths are created. &nbsp;
                <br>
                <i>Optional - defaults to&nbsp;componentName&nbsp;</i>
              </li>
            </ol>
            <p>The result of downloading each component will be a folder as follows:
              <br>
            </p>
            <ol>
              <li>
                <i>
                  <b>c:\obsidian\componentName</b>
                </i>Where the instalation is placed;
                <br>This will have a batch file to invoke the setting of the PATH environment
                variable;</li>
              <li>
                <i>
                  <b>c:\obsidian\componentName\componentName-version</b>
                </i>Where the ZIP is extracted to;</li>
              <li>
                <i>
                  <b>c:\obsidian\componentName\componentName-version\componentSubPath</b>
                </i>is where the executables reside within the extracted zip (ie. The Java
                home);</li>
            </ol>
            <p>The return value (true if installed) is passed to a variable that is used
              later when determining if the installer should be executed for this component.
              &nbsp;</p>
            <p>After each component is installed two Windows environment variables are
              created for the user.
              <br>The first is&nbsp;</p>
            <h4>setupComponentShortcuts()</h4>
            <p>This creates a short cut to the application on the developer's desktop.</p>
            <img src="assets\images\how-it-works\setupComponentShortcuts.PNG" class="img-responsive">
              <p>The parameters are:</p>
              <ol>
                <li>
                  <b>componentName&nbsp;</b>The name and the folder to install the component
                  into;</li>
                <li>
                  <b>exePath</b>&nbsp;the path of the executable within the component folder;</li>
              </ol>
              <h4>runAllComponentInstallers()</h4>
              <p>Installs the component using the downloaded installer:
                <br>
              </p>
              <img src="assets\images\how-it-works\runAllComponentInstallers.PNG" class="img-responsive">
              <p contenteditable="true">This is slightly more functional than the other sections. In that it needs
                to use a variable set when the component is down loaded to determine if
                a new install needs to occur.
                <br>The parameters for this are:</p>
              <ol>
                <li>
                  <b>componentName&nbsp;</b>The name and the folder to install the component
                  into;&nbsp;
                  <br>
                </li>
                <li>
                  <b>exePath</b>the path of the instalation executable within the component
                  folder;&nbsp;</li>
              </ol>
          </div>
        </div>
      </div>
    </div>
  
